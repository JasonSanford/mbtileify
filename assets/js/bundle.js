(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){var request=require("superagent");var Map=require("./map");function JobApp(){var map=new Map(mbtileify.jobTileUrl,{minZoom:mbtileify.jobMinZoom,maxZoom:mbtileify.jobMaxZoom});var boundsLayer=new L.GeoJSON(window.mbtileify.jobBoundsGeoJSON,{color:"#333",opacity:.9,weight:2,fillColor:"#333",fillOpacity:.4});boundsLayer.addTo(map);map.fitBounds(boundsLayer.getBounds());if(mbtileify.jobProgress<100){initiateJobProgress()}}function initiateJobProgress(){var inerval;var progressBarElem=document.querySelectorAll(".progress-bar")[0];function checkProgress(){request.get("/jobs/"+window.mbtileify.jobId+".json").end(processProgress)}function processProgress(error,resp){if(error){window.clearInterval(interval);console.log("Error fetching progress: ",error);return}var body=resp.body;var percentage=body.progress>=100?99:body.progress;var progressPercentage=percentage+"%";progressBarElem.style.width=progressPercentage;progressBarElem.innerText=progressPercentage;if(body.state==="complete"){window.clearInterval(interval);document.location.reload(true)}}interval=window.setInterval(checkProgress,3e3)}module.exports=JobApp},{"./map":2,superagent:5}],2:[function(require,module,exports){function Map(tileUrl,options){var map;var opts={center:[40,-100],zoom:4};if(options&&options.minZoom&&options.maxZoom){opts.minZoom=options.minZoom;opts.maxZoom=options.maxZoom;opts.zoom=options.minZoom}if(tileUrl){map=new L.Map("map",opts);L.tileLayer(tileUrl).addTo(map)}else{map=new L.mapbox.Map("map","jcsanford.kmdnbkib",opts)}return map}module.exports=Map},{}],3:[function(require,module,exports){var cover=require("tile-cover");var Map=require("./map");var utils=require("./utils");function SetupApp(){var me=this;this.drawCreated=utils.bind(this.drawCreated,this);this.drawStart=utils.bind(this.drawStart,this);this.drawDeleted=utils.bind(this.drawDeleted,this);this.boundsUpdated=utils.bind(this.boundsUpdated,this);this.tileUrlChanged=utils.bind(this.tileUrlChanged,this);this.onsubmit=utils.bind(this.onsubmit,this);this.alertIntroElem=document.querySelectorAll(".alert-intro")[0];this.formElem=document.querySelectorAll(".form-horizontal")[0];this.boundsXMinHiddenElem=document.querySelectorAll(".bounds-xmin-hidden")[0];this.boundsYMinHiddenElem=document.querySelectorAll(".bounds-ymin-hidden")[0];this.boundsXMaxHiddenElem=document.querySelectorAll(".bounds-xmax-hidden")[0];this.boundsYMaxHiddenElem=document.querySelectorAll(".bounds-ymax-hidden")[0];this.totalCountElem=document.querySelectorAll(".total-count")[0];this.zoomElems=document.querySelectorAll(".min-zoom, .max-zoom");this.minZoomElem=document.querySelectorAll(".min-zoom")[0];this.maxZoomElem=document.querySelectorAll(".max-zoom")[0];this.tileUrlElem=document.querySelectorAll(".tile-url")[0];this.map=new Map;this.overlayTileLayer=new L.TileLayer(this.tileUrlElem.value);this.map.addLayer(this.overlayTileLayer);this.featureGroup=L.featureGroup();this.featureGroup.addTo(this.map);this.drawControl=new DrawControl(this.featureGroup);this.drawControl.control.addTo(this.map);this.tileCountDisplay=new TileCountDisplay;this.map.on("draw:created",this.drawCreated);this.map.on("draw:drawstart",this.drawStart);this.map.on("draw:editstop",this.boundsUpdated);this.map.on("draw:deleted",this.drawDeleted);this.tileUrlElem.oninput=this.tileUrlChanged;this.formElem.onsubmit=this.onsubmit;[].forEach.call(this.zoomElems,function(zoom){zoom.addEventListener("change",function(event){var value=parseInt(this.value,10);if(zoom.classList.contains("min-zoom")){if(value>parseInt(me.maxZoomElem.value,10)){this.value=me.maxZoomElem.value}else{me.calculateTileCover()}}else{if(value<parseInt(me.minZoomElem.value,10)){this.value=me.minZoomElem.value}else{me.calculateTileCover()}}},false)})}SetupApp.prototype.onsubmit=function(event){};SetupApp.prototype.tileUrlChanged=function(){this.overlayTileLayer.setUrl(this.tileUrlElem.value)};SetupApp.prototype.drawStart=function(){this.alertIntroElem.style.display="none";this.formElem.style.display="block";this.tileCountDisplay.show();this.clearCurrentFeature()};SetupApp.prototype.drawCreated=function(event){this.featureGroup.addLayer(event.layer);this.boundsUpdated()};SetupApp.prototype.drawDeleted=function(){this.alertIntroElem.style.display="block";this.formElem.style.display="none";this.tileCountDisplay.clear();this.tileCountDisplay.hide();this.boundsUpdated()};SetupApp.prototype.clearCurrentFeature=function(){this.featureGroup.clearLayers()};SetupApp.prototype.boundsUpdated=function(){var layers=this.featureGroup.getLayers();var layer=layers.length?layers[0]:null;if(layer){this.bounds=layer.getBounds();var sw=this.bounds.getSouthWest();var ne=this.bounds.getNorthEast();this.boundsXMinHiddenElem.value=sw.lng;this.boundsYMinHiddenElem.value=sw.lat;this.boundsXMaxHiddenElem.value=ne.lng;this.boundsYMaxHiddenElem.value=ne.lat;this.calculateTileCover()}else{this.bounds=null}};SetupApp.prototype.calculateTileCover=function(){var minZoom=parseInt(this.minZoomElem.value,10);var maxZoom=parseInt(this.maxZoomElem.value,10);var sw=this.bounds.getSouthWest();var ne=this.bounds.getNorthEast();var geom={type:"Polygon",coordinates:[[[sw.lng,sw.lat],[sw.lng,ne.lat],[ne.lng,ne.lat],[ne.lng,sw.lat],[sw.lng,sw.lat]]]};var tiles={};for(var i=minZoom;i<=maxZoom;i++){tiles[i]=cover.tiles(geom,{min_zoom:i,max_zoom:i})}this.tileCountDisplay.update(tiles);this.totalCountElem.value=this.tileCountDisplay.getTotal();this.tileCountDisplay.show()};function TileCountDisplay(){this.container=document.querySelectorAll(".tile-count-display")[0];this.display=document.querySelectorAll(".tile-count")[0]}TileCountDisplay.prototype.update=function(tiles){var zoom,zoomTiles;var htmlParts=[];var totalCount=0;for(zoom in tiles){zoomTiles=tiles[zoom];totalCount+=zoomTiles.length;htmlParts.push("<h5>"+zoom+": <small>"+zoomTiles.length+"</small></h5>")}this.total=totalCount;htmlParts.push("<hr>");htmlParts.push("<h5>Total: <small>"+totalCount+"</small></h5>");this.display.innerHTML=htmlParts.join("")};TileCountDisplay.prototype.clear=function(){this.display.innerHTML=""};TileCountDisplay.prototype.show=function(){this.container.style.display="block"};TileCountDisplay.prototype.hide=function(){this.container.style.display="none"};TileCountDisplay.prototype.getTotal=function(){return this.total};function DrawControl(featureGroup){this.control=new L.Control.Draw({edit:{featureGroup:featureGroup},draw:{polyline:false,polygon:false,circle:false,marker:false,rectangle:{shapeOptions:{color:"#333",fillColor:"#333",opacity:1,fillOpacity:.5,weight:2}}}})}module.exports=SetupApp},{"./map":2,"./utils":4,"tile-cover":8}],4:[function(require,module,exports){function bind(fn,me){return function(){return fn.apply(me,arguments)}}module.exports={bind:bind}},{}],5:[function(require,module,exports){var Emitter=require("emitter");var reduce=require("reduce");var root="undefined"==typeof window?this||self:window;function noop(){}function isHost(obj){var str={}.toString.call(obj);switch(str){case"[object File]":case"[object Blob]":case"[object FormData]":return true;default:return false}}request.getXHR=function(){if(root.XMLHttpRequest&&(!root.location||"file:"!=root.location.protocol||!root.ActiveXObject)){return new XMLHttpRequest}else{try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}}return false};var trim="".trim?function(s){return s.trim()}:function(s){return s.replace(/(^\s*|\s*$)/g,"")};function isObject(obj){return obj===Object(obj)}function serialize(obj){if(!isObject(obj))return obj;var pairs=[];for(var key in obj){if(null!=obj[key]){pairs.push(encodeURIComponent(key)+"="+encodeURIComponent(obj[key]))}}return pairs.join("&")}request.serializeObject=serialize;function parseString(str){var obj={};var pairs=str.split("&");var parts;var pair;for(var i=0,len=pairs.length;i<len;++i){pair=pairs[i];parts=pair.split("=");obj[decodeURIComponent(parts[0])]=decodeURIComponent(parts[1])}return obj}request.parseString=parseString;request.types={html:"text/html",json:"application/json",xml:"application/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"};request.serialize={"application/x-www-form-urlencoded":serialize,"application/json":JSON.stringify};request.parse={"application/x-www-form-urlencoded":parseString,"application/json":JSON.parse};function parseHeader(str){var lines=str.split(/\r?\n/);var fields={};var index;var line;var field;var val;lines.pop();for(var i=0,len=lines.length;i<len;++i){line=lines[i];index=line.indexOf(":");field=line.slice(0,index).toLowerCase();val=trim(line.slice(index+1));fields[field]=val}return fields}function type(str){return str.split(/ *; */).shift()}function params(str){return reduce(str.split(/ *; */),function(obj,str){var parts=str.split(/ *= */),key=parts.shift(),val=parts.shift();if(key&&val)obj[key]=val;return obj},{})}function Response(req,options){options=options||{};this.req=req;this.xhr=this.req.xhr;this.text=this.req.method!="HEAD"&&(this.xhr.responseType===""||this.xhr.responseType==="text")||typeof this.xhr.responseType==="undefined"?this.xhr.responseText:null;this.statusText=this.req.xhr.statusText;this.setStatusProperties(this.xhr.status);this.header=this.headers=parseHeader(this.xhr.getAllResponseHeaders());this.header["content-type"]=this.xhr.getResponseHeader("content-type");this.setHeaderProperties(this.header);this.body=this.req.method!="HEAD"?this.parseBody(this.text?this.text:this.xhr.response):null}Response.prototype.get=function(field){return this.header[field.toLowerCase()]};Response.prototype.setHeaderProperties=function(header){var ct=this.header["content-type"]||"";this.type=type(ct);var obj=params(ct);for(var key in obj)this[key]=obj[key]};Response.prototype.parseBody=function(str){var parse=request.parse[this.type];return parse&&str&&(str.length||str instanceof Object)?parse(str):null};Response.prototype.setStatusProperties=function(status){if(status===1223){status=204}var type=status/100|0;this.status=status;this.statusType=type;this.info=1==type;this.ok=2==type;this.clientError=4==type;this.serverError=5==type;this.error=4==type||5==type?this.toError():false;this.accepted=202==status;this.noContent=204==status;this.badRequest=400==status;this.unauthorized=401==status;this.notAcceptable=406==status;this.notFound=404==status;this.forbidden=403==status};Response.prototype.toError=function(){var req=this.req;var method=req.method;var url=req.url;var msg="cannot "+method+" "+url+" ("+this.status+")";var err=new Error(msg);err.status=this.status;err.method=method;err.url=url;return err};request.Response=Response;function Request(method,url){var self=this;Emitter.call(this);this._query=this._query||[];this.method=method;this.url=url;this.header={};this._header={};this.on("end",function(){var err=null;var res=null;try{res=new Response(self)}catch(e){err=new Error("Parser is unable to parse the response");err.parse=true;err.original=e;return self.callback(err)}self.emit("response",res);if(err){return self.callback(err,res)}if(res.status>=200&&res.status<300){return self.callback(err,res)}var new_err=new Error(res.statusText||"Unsuccessful HTTP response");new_err.original=err;new_err.response=res;new_err.status=res.status;self.callback(err||new_err,res)})}Emitter(Request.prototype);Request.prototype.use=function(fn){fn(this);return this};Request.prototype.timeout=function(ms){this._timeout=ms;return this};Request.prototype.clearTimeout=function(){this._timeout=0;clearTimeout(this._timer);return this};Request.prototype.abort=function(){if(this.aborted)return;this.aborted=true;this.xhr.abort();this.clearTimeout();this.emit("abort");return this};Request.prototype.set=function(field,val){if(isObject(field)){for(var key in field){this.set(key,field[key])}return this}this._header[field.toLowerCase()]=val;this.header[field]=val;return this};Request.prototype.unset=function(field){delete this._header[field.toLowerCase()];delete this.header[field];return this};Request.prototype.getHeader=function(field){return this._header[field.toLowerCase()]};Request.prototype.type=function(type){this.set("Content-Type",request.types[type]||type);return this};Request.prototype.accept=function(type){this.set("Accept",request.types[type]||type);return this};Request.prototype.auth=function(user,pass){var str=btoa(user+":"+pass);this.set("Authorization","Basic "+str);return this};Request.prototype.query=function(val){if("string"!=typeof val)val=serialize(val);if(val)this._query.push(val);return this};Request.prototype.field=function(name,val){if(!this._formData)this._formData=new root.FormData;this._formData.append(name,val);return this};Request.prototype.attach=function(field,file,filename){if(!this._formData)this._formData=new root.FormData;this._formData.append(field,file,filename);return this};Request.prototype.send=function(data){var obj=isObject(data);var type=this.getHeader("Content-Type");if(obj&&isObject(this._data)){for(var key in data){this._data[key]=data[key]}}else if("string"==typeof data){if(!type)this.type("form");type=this.getHeader("Content-Type");if("application/x-www-form-urlencoded"==type){this._data=this._data?this._data+"&"+data:data}else{this._data=(this._data||"")+data}}else{this._data=data}if(!obj||isHost(data))return this;if(!type)this.type("json");return this};Request.prototype.callback=function(err,res){var fn=this._callback;this.clearTimeout();fn(err,res)};Request.prototype.crossDomainError=function(){var err=new Error("Origin is not allowed by Access-Control-Allow-Origin");err.crossDomain=true;this.callback(err)};Request.prototype.timeoutError=function(){var timeout=this._timeout;var err=new Error("timeout of "+timeout+"ms exceeded");err.timeout=timeout;this.callback(err)};Request.prototype.withCredentials=function(){this._withCredentials=true;return this};Request.prototype.end=function(fn){var self=this;var xhr=this.xhr=request.getXHR();var query=this._query.join("&");var timeout=this._timeout;var data=this._formData||this._data;this._callback=fn||noop;xhr.onreadystatechange=function(){if(4!=xhr.readyState)return;var status;try{status=xhr.status}catch(e){status=0}if(0==status){if(self.timedout)return self.timeoutError();if(self.aborted)return;return self.crossDomainError()}self.emit("end")};var handleProgress=function(e){if(e.total>0){e.percent=e.loaded/e.total*100}self.emit("progress",e)};if(this.hasListeners("progress")){xhr.onprogress=handleProgress}try{if(xhr.upload&&this.hasListeners("progress")){xhr.upload.onprogress=handleProgress}}catch(e){}if(timeout&&!this._timer){this._timer=setTimeout(function(){self.timedout=true;self.abort()},timeout)}if(query){query=request.serializeObject(query);this.url+=~this.url.indexOf("?")?"&"+query:"?"+query}xhr.open(this.method,this.url,true);if(this._withCredentials)xhr.withCredentials=true;if("GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof data&&!isHost(data)){var serialize=request.serialize[this.getHeader("Content-Type")];if(serialize)data=serialize(data)}for(var field in this.header){if(null==this.header[field])continue;xhr.setRequestHeader(field,this.header[field])}this.emit("request",this);xhr.send(data);return this};request.Request=Request;function request(method,url){if("function"==typeof url){return new Request("GET",method).end(url)}if(1==arguments.length){return new Request("GET",method)}return new Request(method,url)}request.get=function(url,data,fn){var req=request("GET",url);if("function"==typeof data)fn=data,data=null;if(data)req.query(data);if(fn)req.end(fn);return req};request.head=function(url,data,fn){var req=request("HEAD",url);if("function"==typeof data)fn=data,data=null;if(data)req.send(data);if(fn)req.end(fn);return req};request.del=function(url,fn){var req=request("DELETE",url);if(fn)req.end(fn);return req};request.patch=function(url,data,fn){var req=request("PATCH",url);if("function"==typeof data)fn=data,data=null;if(data)req.send(data);if(fn)req.end(fn);return req};request.post=function(url,data,fn){var req=request("POST",url);if("function"==typeof data)fn=data,data=null;if(data)req.send(data);if(fn)req.end(fn);return req};request.put=function(url,data,fn){var req=request("PUT",url);if("function"==typeof data)fn=data,data=null;if(data)req.send(data);if(fn)req.end(fn);return req};module.exports=request},{emitter:6,reduce:7}],6:[function(require,module,exports){module.exports=Emitter;function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks[event]=this._callbacks[event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){var self=this;this._callbacks=this._callbacks||{};function on(){self.off(event,on);fn.apply(this,arguments)}on.fn=fn;this.on(event,on);return this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var callbacks=this._callbacks[event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks[event];return this}var cb;for(var i=0;i<callbacks.length;i++){cb=callbacks[i];if(cb===fn||cb.fn===fn){callbacks.splice(i,1);break}}return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks[event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],7:[function(require,module,exports){module.exports=function(arr,fn,initial){var idx=0;var len=arr.length;var curr=arguments.length==3?initial:arr[idx++];while(idx<len){curr=fn.call(null,curr,arr[idx],++idx,arr)}return curr}},{}],8:[function(require,module,exports){var tilebelt=require("tilebelt");module.exports.geojson=function(geom,limits){var locked=getLocked(geom,limits);var tileFeatures=locked.map(function(t){return{type:"Feature",geometry:tilebelt.tileToGeoJSON(t),properties:{}}});return{type:"FeatureCollection",features:tileFeatures}};module.exports.tiles=function(geom,limits){var locked=getLocked(geom,limits);return locked};module.exports.indexes=function(geom,limits){var locked=getLocked(geom,limits);return locked.map(function(tile){return tilebelt.tileToQuadkey(tile)})};function getLocked(geom,limits){var locked,i,tileHash={};if(geom.type==="Point"){locked=[tilebelt.pointToTile(geom.coordinates[0],geom.coordinates[1],limits.max_zoom)]}else if(geom.type==="MultiPoint"){var quadkeys={};locked=[];for(i=0;i<geom.coordinates.length;i++){var tile=tilebelt.pointToTile(geom.coordinates[i][0],geom.coordinates[i][1],limits.max_zoom);var quadkey=tilebelt.tileToQuadkey(tile);if(!quadkeys[quadkey]){quadkeys[quadkey]=true;locked.push(tile)}}}else if(geom.type==="LineString"){lineCover(tileHash,geom.coordinates,limits.max_zoom)}else if(geom.type==="MultiLineString"){for(i=0;i<geom.coordinates.length;i++){lineCover(tileHash,geom.coordinates[i],limits.max_zoom)}}else if(geom.type==="Polygon"){polyRingCover(tileHash,geom.coordinates,limits.max_zoom)}else if(geom.type==="MultiPolygon"){for(i=0;i<geom.coordinates.length;i++){polyRingCover(tileHash,geom.coordinates[i],limits.max_zoom)}}else{throw new Error("Geometry type not implemented")}if(!locked){if(limits.min_zoom!==limits.max_zoom){tileHash=mergeTiles(tileHash,limits)}locked=hashToArray(tileHash)}return locked}function mergeTiles(tileHash,limits){var mergedTileHash={};for(var z=limits.max_zoom;z>limits.min_zoom;z--){var keys=Object.keys(tileHash);var parentTileHash={};for(var i=0;i<keys.length;i++){var id1=+keys[i],t=fromID(id1);if(t[0]%2===0&&t[1]%2===0){var id2=toID(t[0]+1,t[1],z),id3=toID(t[0],t[1]+1,z),id4=toID(t[0]+1,t[1]+1,z);if(tileHash[id2]&&tileHash[id3]&&tileHash[id4]){tileHash[id1]=false;tileHash[id2]=false;tileHash[id3]=false;tileHash[id4]=false;var parentId=toID(t[0]/2,t[1]/2,z-1);(z-1===limits.min_zoom?mergedTileHash:parentTileHash)[parentId]=true}}}for(var i=0;i<keys.length;i++){if(tileHash[keys[i]]){mergedTileHash[+keys[i]]=true}}tileHash=parentTileHash}return mergedTileHash}function polyRingCover(tileHash,geom,max_zoom){var tiled=getTiledPoly(geom,max_zoom);var y=tiled.minY;while(y<=tiled.maxY){var intersections=[];for(var r=0;r<tiled.geom.length;r++){var ring=tiled.geom[r];for(var i=0;i<ring.length;i++){var curr=ring[i];var next=ring[i+1]||ring[0];var localMin=isLocalMin(i,ring);var localMax=isLocalMax(i,ring);var intersection=lineIntersects(0,y,1,y,curr[0],curr[1],next[0],next[1],localMin||localMax);if(intersection){intersections.push([Math.round(intersection[0]),Math.round(intersection[1]),r,i,"nonhoriz",localMin,localMax])}}}intersections.sort(compareX);for(var i=0;i<intersections.length-1;i++){if(i%2===0){var enter=intersections[i][0];var exit=intersections[i+1][0];var x=enter;while(x<=exit){tileHash[toID(x,y,max_zoom)]=true;x++}}}y++}for(var i=0;i<geom.length;i++){lineCover(tileHash,geom[i],max_zoom)}}function compareX(a,b){return a[0]-b[0]}module.exports.getTiledPoly=getTiledPoly;function getTiledPoly(geom,max_zoom,latlon){var minY=Infinity;var maxY=-Infinity;var tiled=[];var ring;var last;for(var i=0;i<geom.length;i++){tiledRing=[];last=[];for(var k=0;k<geom[i].length;k++){var next=tilebelt.pointToTile(geom[i][k][0],geom[i][k][1],max_zoom);if(latlon){var bbox=tilebelt.tileToBBOX(next,max_zoom);next=[bbox[0]+(bbox[2]-bbox[0])*.5,bbox[1]+(bbox[3]-bbox[1])*.5]}if(last[0]===next[0]&&last[1]===next[1])continue;minY=Math.min(minY,next[1]);maxY=Math.max(maxY,next[1]);tiledRing.push(next);last=next}if(tiledRing.length>=4)tiled.push(tiledRing)}return{minY:minY,maxY:maxY,geom:tiled}}module.exports.isLocalMin=isLocalMin;module.exports.isLocalMax=isLocalMax;function isLocalMin(i,ring){var mod=ring.length;var prev=ring[i];var curr=ring[(i+1)%mod];var next=ring[(i+2)%mod];if(curr[1]>=prev[1])return false;var j=(i+1)%mod;while(j!==i&&curr[1]===next[1]){next=ring[(j+2)%mod];j=(j+1)%mod}return curr[1]<next[1]}function isLocalMax(i,ring){var mod=ring.length;var prev=ring[i];var curr=ring[(i+1)%mod];var next=ring[(i+2)%mod];if(curr[1]<=prev[1])return false;var j=(i+1)%mod;while(j!==i&&curr[1]===next[1]){next=ring[(j+2)%mod];j=(j+1)%mod}return curr[1]>next[1]}function lineIntersects(line1StartX,line1StartY,line1EndX,line1EndY,line2StartX,line2StartY,line2EndX,line2EndY,localMinMax){var denominator,a,b,numerator1,numerator2,onLine1=false,onLine2=false,res=[null,null];denominator=(line2EndY-line2StartY)*(line1EndX-line1StartX)-(line2EndX-line2StartX)*(line1EndY-line1StartY);if(denominator===0){if(res[0]!==null&&res[1]!==null){return res}else{return false}}a=line1StartY-line2StartY;b=line1StartX-line2StartX;numerator1=(line2EndX-line2StartX)*a-(line2EndY-line2StartY)*b;numerator2=(line1EndX-line1StartX)*a-(line1EndY-line1StartY)*b;a=numerator1/denominator;b=numerator2/denominator;res[0]=line1StartX+a*(line1EndX-line1StartX);res[1]=line1StartY+a*(line1EndY-line1StartY);if(b>0&&b<1||res[0]===line2StartX&&res[1]===line2StartY||localMinMax&&res[0]===line2EndX&&res[1]===line2EndY){return res}else{return false}}function lineCover(tileHash,coords,max_zoom){for(var i=0;i<coords.length-1;i++){var start=tilebelt.pointToTileFraction(coords[i][0],coords[i][1],max_zoom),stop=tilebelt.pointToTileFraction(coords[i+1][0],coords[i+1][1],max_zoom),x0=start[0],y0=start[1],x1=stop[0],y1=stop[1],dx=x1-x0,dy=y1-y0,sx=dx>0?1:-1,sy=dy>0?1:-1,x=Math.floor(x0),y=Math.floor(y0),tMaxX=Math.abs(((dx>0?1:0)+x-x0)/dx),tMaxY=Math.abs(((dy>0?1:0)+y-y0)/dy),tdx=Math.abs(sx/dx),tdy=Math.abs(sy/dy);tileHash[toID(x,y,max_zoom)]=true;if(dy===0&&dx===0)continue;if(isNaN(tMaxX))tMaxX=Infinity;if(isNaN(tMaxY))tMaxY=Infinity;while(tMaxX<1||tMaxY<1){if(tMaxX<tMaxY){tMaxX+=tdx;x+=sx}else{tMaxY+=tdy;y+=sy}tileHash[toID(x,y,max_zoom)]=true}}}function hashToArray(hash){var keys=Object.keys(hash);var tiles=[];for(var i=0;i<keys.length;i++){tiles.push(fromID(+keys[i]))}return tiles}function toID(x,y,z){var dim=2*(1<<z);return(dim*y+x)*32+z}function fromID(id){var z=id%32,dim=2*(1<<z),xy=(id-z)/32,x=xy%dim,y=(xy-x)/dim%dim;return[x,y,z]}},{tilebelt:9}],9:[function(require,module,exports){var d2r=Math.PI/180,r2d=180/Math.PI;function tileToBBOX(tile){var e=tile2lon(tile[0]+1,tile[2]);var w=tile2lon(tile[0],tile[2]);var s=tile2lat(tile[1]+1,tile[2]);var n=tile2lat(tile[1],tile[2]);return[w,s,e,n]}function tileToGeoJSON(tile){var bbox=tileToBBOX(tile);var poly={type:"Polygon",coordinates:[[[bbox[0],bbox[1]],[bbox[0],bbox[3]],[bbox[2],bbox[3]],[bbox[2],bbox[1]],[bbox[0],bbox[1]]]]};return poly}function tile2lon(x,z){return x/Math.pow(2,z)*360-180}function tile2lat(y,z){var n=Math.PI-2*Math.PI*y/Math.pow(2,z);return r2d*Math.atan(.5*(Math.exp(n)-Math.exp(-n)))}function pointToTile(lon,lat,z){var latr=lat*d2r,z2=Math.pow(2,z);return[Math.floor((lon+180)/360*z2),Math.floor((1-Math.log(Math.tan(latr)+1/Math.cos(latr))/Math.PI)/2*z2),z]}function getChildren(tile){return[[tile[0]*2,tile[1]*2,tile[2]+1],[tile[0]*2+1,tile[1]*2,tile[2]+1],[tile[0]*2+1,tile[1]*2+1,tile[2]+1],[tile[0]*2,tile[1]*2+1,tile[2]+1]]}function getParent(tile){if(tile[0]%2===0&&tile[1]%2===0){return[tile[0]/2,tile[1]/2,tile[2]-1]}else if(tile[0]%2===0&&!tile[1]%2===0){return[tile[0]/2,(tile[1]-1)/2,tile[2]-1]}else if(!tile[0]%2===0&&tile[1]%2===0){return[(tile[0]-1)/2,tile[1]/2,tile[2]-1]}else{return[(tile[0]-1)/2,(tile[1]-1)/2,tile[2]-1]}}function getSiblings(tile){return getChildren(getParent(tile))}function hasSiblings(tile,tiles){var siblings=getSiblings(tile);for(var i=0;i<siblings.length;i++){if(!hasTile(tiles,siblings[i]))return false}return true}function hasTile(tiles,tile){for(var i=0;i<tiles.length;i++){if(tilesEqual(tiles[i],tile))return true}return false}function tilesEqual(tile1,tile2){return tile1[0]===tile2[0]&&tile1[1]===tile2[1]&&tile1[2]===tile2[2]}function tileToQuadkey(tile){var index="";for(var z=tile[2];z>0;z--){var b=0;var mask=1<<z-1;if((tile[0]&mask)!==0)b++;if((tile[1]&mask)!==0)b+=2;index+=b.toString()}return index}function quadkeyToTile(quadkey){var x=0;var y=0;var z=quadkey.length;for(var i=z;i>0;i--){var mask=1<<i-1;switch(quadkey[z-i]){case"0":break;case"1":x|=mask;break;case"2":y|=mask;break;case"3":x|=mask;y|=mask;break}}return[x,y,z]}function bboxToTile(bboxCoords){var min=pointToTile(bboxCoords[0],bboxCoords[1],32);var max=pointToTile(bboxCoords[2],bboxCoords[3],32);var bbox=[min[0],min[1],max[0],max[1]];var z=getBboxZoom(bbox);if(z===0)return[0,0,0];var x=bbox[0]>>>32-z;var y=bbox[1]>>>32-z;return[x,y,z]}function getBboxZoom(bbox){var MAX_ZOOM=28;for(var z=0;z<MAX_ZOOM;z++){var mask=1<<32-(z+1);if((bbox[0]&mask)!=(bbox[2]&mask)||(bbox[1]&mask)!=(bbox[3]&mask)){return z}}return MAX_ZOOM}function pointToTileFraction(lon,lat,z){var tile=pointToTile(lon,lat,z);var bbox=tileToBBOX(tile);var xTileOffset=bbox[2]-bbox[0];var xPointOffset=lon-bbox[0];var xPercentOffset=xPointOffset/xTileOffset;var yTileOffset=bbox[1]-bbox[3];var yPointOffset=lat-bbox[3];var yPercentOffset=yPointOffset/yTileOffset;return[tile[0]+xPercentOffset,tile[1]+yPercentOffset,z]}module.exports={tileToGeoJSON:tileToGeoJSON,tileToBBOX:tileToBBOX,getChildren:getChildren,getParent:getParent,getSiblings:getSiblings,hasTile:hasTile,hasSiblings:hasSiblings,tilesEqual:tilesEqual,tileToQuadkey:tileToQuadkey,quadkeyToTile:quadkeyToTile,pointToTile:pointToTile,bboxToTile:bboxToTile,pointToTileFraction:pointToTileFraction}},{}],10:[function(require,module,exports){var SetupApp=require("./setup_app");var JobApp=require("./job_app");if(document.body.classList.contains("index")){new SetupApp}else if(document.body.classList.contains("job")){new JobApp}},{"./job_app":1,"./setup_app":3}]},{},[10]);
